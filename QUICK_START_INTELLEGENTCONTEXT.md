# 🚀 聊天模式 - 快速启动指南

## 立即开始使用

### 📋 前置步骤 (必须完成)

1. **执行数据库脚本**

   ```sql
   -- 在 Supabase SQL Editor 中执行
   \i create_summaries_table.sql
   ```

2. **验证外键约束修复** (如果之前遇到清空聊天记录的问题)
   ```sql
   -- 在 Supabase SQL Editor 中执行
   \i fix_diary_foreign_keys.sql
   ```

### 🎮 开始体验

1. **进入聊天页面**

   - 选择任意角色开始对话
   - 确保 API 密钥已配置

2. **启用智能模式**

   - 点击顶部工具栏的 🧠 图标
   - 开启"启用增强模式"开关

3. **测试智能截断**
   - 进行 20 条以上的对话
   - 观察上下文统计变化
   - 查看摘要生成效果

## 🎯 核心优势

### 即刻体验的改进

- **📊 实时统计**: 看到准确的 token 使用情况
- **🧠 智能截断**: 不再担心上下文过长导致的性能问题
- **⚡ 自动摘要**: 长对话中 AI 依然记得很久以前的事情
- **💰 成本控制**: 可预测的 API 调用成本

### 对比效果

| 功能       | 原版聊天                | SillyTavern 增强版  |
| ---------- | ----------------------- | ------------------- |
| 长对话记忆 | ❌ 会遗忘               | ✅ 智能摘要保持记忆 |
| Token 控制 | ❌ 无法预测             | ✅ 精确管理         |
| 性能稳定性 | ❌ 可能因上下文过长变慢 | ✅ 始终稳定         |
| 成本可控性 | ❌ 不可预测             | ✅ 完全可控         |

## ⚙️ 推荐配置

### 🆕 新用户推荐

```
最大上下文: 4000 tokens
预留生成空间: 1000 tokens
摘要阈值: 20 条消息
保留最近消息: 10 条
```

### 🎭 角色扮演用户

```
最大上下文: 6000 tokens
预留生成空间: 1500 tokens
摘要阈值: 25 条消息
保留最近消息: 12 条
```

### 💸 成本敏感用户

```
最大上下文: 3000 tokens
预留生成空间: 800 tokens
摘要阈值: 15 条消息
保留最近消息: 6 条
```

## 🔍 观察要点

### 正常工作的标志

- ✅ 上下文统计显示合理的 token 数量
- ✅ 长对话中出现"⚡ 已启用智能摘要"提示
- ✅ AI 在长对话中仍记得早期的重要信息
- ✅ 截断消息数逐渐增加，但对话质量不受影响

### 需要调整的信号

- ⚠️ 总 Token 数经常接近最大值
- ⚠️ 截断消息数过多（超过对话总数的 50%）
- ⚠️ AI 频繁忘记重要信息
- ⚠️ 摘要生成失败

## 🛠️ 常见调整

### Token 不够用

- 增加"最大上下文"
- 减少"保留最近消息"
- 降低"摘要阈值"

### 成本太高

- 降低"最大上下文"
- 减少"预留生成空间"
- 提高"摘要阈值"

### 记忆效果不好

- 降低"摘要阈值"（更频繁地生成摘要）
- 增加"保留最近消息"
- 检查摘要质量

## 📱 模型特定建议

点击"应用模型推荐配置"会根据当前模型自动优化设置：

- **DeepSeek**: 平衡的 4K 上下文配置
- **GPT-4**: 充分利用 8K 上下文能力
- **Gemini**: 优化的 8K 配置，支持长文本
- **GPT-3.5**: 经济实用的 4K 配置

## 🚨 注意事项

1. **首次使用**: 建议先用默认配置体验，再根据实际效果调整
2. **模型切换**: 更换 AI 模型时记得应用推荐配置
3. **摘要质量**: 摘要由 AI 生成，质量取决于所选模型
4. **实验精神**: 不同的配置适合不同的使用场景，多试验找到最佳设置

## 🎉 享受体验

现在你拥有了专业级的对话上下文管理系统！无论是深度角色扮演、长篇故事创作，还是日常 AI 对话，都能获得更加稳定和智能的体验。

**开始你的智能对话之旅吧！** 🚀
